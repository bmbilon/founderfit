<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FounderFit Score‚Ñ¢ Survey</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --color-primary: #1f8a70;
            --color-primary-light: #2aaa8a;
            --color-primary-dark: #166b54;
            --color-secondary: #f5f5f5;
            --color-text: #2c3e50;
            --color-text-light: #7f8c8d;
            --color-border: #e0e0e0;
            --color-success: #27ae60;
            --color-warning: #e67e22;
            --color-danger: #c0152f;
            --color-bg-light: #f8f9fa;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
        }

        * { box-sizing: border-box; }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .admin-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
        }

        .admin-button:hover {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .admin-modal.active {
            display: flex;
        }

        .admin-modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            padding: 40px;
            text-align: center;
        }

        .admin-modal-content h2 {
            margin-top: 0;
            color: var(--color-primary);
            font-size: 24px;
        }

        .admin-modal-content input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.2s ease;
        }

        .admin-modal-content input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .admin-modal-content button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 10px;
        }

        .admin-modal-content button:hover {
            background: var(--color-primary-dark);
        }

        .admin-modal-content button.cancel {
            background: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .admin-modal-content button.cancel:hover {
            background: var(--color-border);
        }

        .admin-error {
            color: var(--color-danger);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 2001;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 24px;
        }

        .admin-close {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .admin-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .admin-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .admin-section {
            margin-bottom: 50px;
            background: var(--color-bg-light);
            padding: 30px;
            border-radius: 12px;
            border-left: 4px solid var(--color-primary);
        }

        .admin-section h2 {
            margin-top: 0;
            color: var(--color-primary);
            font-size: 20px;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 15px;
        }

        .admin-section h3 {
            color: var(--color-text);
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .dimension-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .dimension-table th {
            background: var(--color-primary);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }

        .dimension-table td {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
        }

        .dimension-table tr:last-child td {
            border-bottom: none;
        }

        .dimension-table tr:hover {
            background: var(--color-bg-light);
        }

        .dimension-table .q-id {
            font-weight: 600;
            color: var(--color-primary);
        }

        .score-band {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-band-range {
            font-weight: 600;
            color: var(--color-primary);
            min-width: 80px;
        }

        .coaching-box {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--color-warning);
        }

        .coaching-box strong {
            color: var(--color-warning);
        }

        .header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
            color: white;
            padding: 50px 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            margin: 0 0 8px 0;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }

        .header p {
            margin: 8px 0;
            font-size: 15px;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.25);
            margin-top: 25px;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
        }

        .progress-text {
            font-size: 13px;
            margin-top: 12px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .content {
            padding: 50px 40px;
        }

        .question-container {
            margin-bottom: 40px;
            display: none;
        }

        .question-container.active {
            display: block;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(12px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .question-number {
            font-size: 12px;
            color: var(--color-text-light);
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .question-type {
            font-size: 12px;
            color: var(--color-text-light);
            font-style: italic;
            margin-bottom: 20px;
        }

        .option {
            background: white;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: flex-start;
        }

        .option:hover {
            border-color: var(--color-primary);
            background: rgba(31, 138, 112, 0.05);
        }

        .option.selected {
            border-color: var(--color-primary);
            background: rgba(31, 138, 112, 0.1);
            font-weight: 600;
        }

        .option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--color-primary);
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
        }

        .likert-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .likert-option {
            text-align: center;
        }

        .likert-option input[type="radio"] {
            display: none;
        }

        .likert-label {
            display: block;
            padding: 12px 8px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            background: white;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            line-height: 1.3;
        }

        .likert-option input[type="radio"]:checked + .likert-label {
            border-color: var(--color-primary);
            background: rgba(31, 138, 112, 0.1);
            color: var(--color-primary);
            font-weight: 600;
        }

        .likert-label:hover {
            border-color: var(--color-primary);
            background: rgba(31, 138, 112, 0.05);
        }

        .likert-legend {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 8px;
            font-size: 11px;
            color: var(--color-text-light);
            font-style: italic;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: space-between;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-prev {
            background: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-prev:hover:not(:disabled) {
            background: var(--color-border);
        }

        .btn-prev:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-next {
            background: var(--color-primary);
            color: white;
            flex: 1;
        }

        .btn-next:hover {
            background: var(--color-primary-light);
        }

        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .email-collection-container {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .email-collection-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .email-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text);
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn-submit-email {
            width: 100%;
            padding: 14px 24px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }

        .btn-submit-email:hover {
            background: var(--color-primary-dark);
        }

        .privacy-note {
            font-size: 12px;
            color: var(--color-text-light);
            margin-top: 12px;
            font-style: italic;
        }

        .results-container {
            display: none;
            text-align: center;
        }

        .results-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .score-display {
            font-size: 64px;
            font-weight: 700;
            color: var(--color-primary);
            margin: 20px 0;
        }

        .score-interpretation {
            font-size: 16px;
            color: var(--color-text);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .dimension-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 30px;
            text-align: left;
        }

        .dimension-item {
            background: var(--color-secondary);
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
        }

        .dimension-name {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .dimension-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .btn-reset {
            background: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            margin-top: 20px;
        }

        .btn-reset:hover {
            background: var(--color-border);
        }

        @media (max-width: 768px) {
            .header { padding: 30px 20px; }
            .header h1 { font-size: 22px; }
            .content { padding: 20px; }
            .dimension-scores { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .btn-prev { order: 2; }
            .btn-next { order: 1; }
            .likert-scale { grid-template-columns: repeat(5, 1fr); gap: 4px; }
            .likert-label { padding: 8px 2px; font-size: 10px; min-height: 80px; }
            .option { flex-direction: column; }
            .option input[type="radio"] { margin-right: 0; margin-bottom: 8px; }
            .admin-button { top: 10px; right: 10px; padding: 8px 12px; font-size: 12px; }
        }
    </style>
</head>
<body>
    <button class="admin-button" onclick="openAdminLogin()">üîê Admin</button>

    <div class="admin-modal" id="admin-login-modal">
        <div class="admin-modal-content">
            <h2>Administrator Access</h2>
            <div class="admin-error" id="admin-error" style="display: none;"></div>
            <input type="password" id="admin-password" placeholder="Enter password" onkeypress="if(event.key==='Enter') checkAdminPassword()">
            <div style="text-align: right;">
                <button class="cancel" onclick="closeAdminLogin()">Cancel</button>
                <button onclick="checkAdminPassword()">Login</button>
            </div>
        </div>
    </div>

    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <h1>Administrator Panel - FounderFit Score‚Ñ¢ v2.1</h1>
            <button class="admin-close" onclick="closeAdminPanel()">Close</button>
        </div>
        <div class="admin-content">
            <div class="admin-section">
                <h2>üìä Survey Overview</h2>
                <p><strong>Total Questions:</strong> 22</p>
                <p><strong>Question Types:</strong> Binary choices (12) + Likert scale 1-5 (10)</p>
                <p><strong>Dimensions Assessed:</strong> 6 key founder personality traits</p>
                <p><strong>Scoring Method:</strong> Dimension averages converted to 0-100 scale, then overall average</p>
            </div>

            <div class="admin-section">
                <h2>üìã Dimensions & Questions Breakdown</h2>
                
                <h3>Dimension 1: Openness (5 questions)</h3>
                <p><em>Measures willingness to explore new ideas, challenge conventions, and embrace experimentation.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td class="q-id">A1</td>
                            <td>Novel market opportunity vs. strategic fit</td>
                            <td>Binary</td>
                            <td>0 = Strategic, 1 = Exploratory</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td class="q-id">A2</td>
                            <td>Product development approach</td>
                            <td>Binary</td>
                            <td>0 = Data-driven, 1 = Experimental</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td class="q-id">A3</td>
                            <td>Industry conventions</td>
                            <td>Binary</td>
                            <td>0 = Respectful, 1 = Challenging</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td class="q-id">A4</td>
                            <td>Learning new technology</td>
                            <td>Binary</td>
                            <td>0 = Foundational, 1 = Hands-on</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td class="q-id">A5</td>
                            <td>Decisions with incomplete information</td>
                            <td>Likert</td>
                            <td>1 = Cautious, 5 = Confident</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 5 responses, scaled to 0-100</p>

                <h3>Dimension 2: Conscientiousness (3 questions)</h3>
                <p><em>Measures attention to detail, follow-through, and operational rigor as the business scales.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>6</td>
                            <td class="q-id">BCONS1</td>
                            <td>Complex project management</td>
                            <td>Binary</td>
                            <td>0 = Vision-focused, 1 = Detail-oriented</td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td class="q-id">BCONS2</td>
                            <td>Operational tasks at scale</td>
                            <td>Binary</td>
                            <td>0 = Delegating, 1 = Hands-on</td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td class="q-id">BCONS3</td>
                            <td>Project commitment vs. new opportunity</td>
                            <td>Likert</td>
                            <td>1 = Abandon easily, 5 = Complete regardless</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 3 responses, scaled to 0-100</p>

                <h3>Dimension 3: Energy & Drive (4 questions)</h3>
                <p><em>Measures resilience, ambition, goal orientation, and ability to rally teams.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>9</td>
                            <td class="q-id">C1</td>
                            <td>Response to major setback</td>
                            <td>Binary</td>
                            <td>0 = Reflective, 1 = Rapid pivot</td>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td class="q-id">C2</td>
                            <td>Approach to growth targets</td>
                            <td>Binary</td>
                            <td>0 = Realistic, 1 = Audacious</td>
                        </tr>
                        <tr>
                            <td>11</td>
                            <td class="q-id">C3</td>
                            <td>Team leadership style</td>
                            <td>Binary</td>
                            <td>0 = One-on-one, 1 = Vision-rallying</td>
                        </tr>
                        <tr>
                            <td>12</td>
                            <td class="q-id">C4</td>
                            <td>Multi-year goal commitment</td>
                            <td>Likert</td>
                            <td>1 = Abandons easily, 5 = Obsessive</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 4 responses, scaled to 0-100</p>

                <h3>Dimension 4: Conviction (3 questions)</h3>
                <p><em>Measures confidence in strategic direction, defensibility of thesis, and resistance to influence.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>13</td>
                            <td class="q-id">DCONV1</td>
                            <td>Disagreement with team/investors</td>
                            <td>Binary</td>
                            <td>0 = Open to adjustment, 1 = Confident defense</td>
                        </tr>
                        <tr>
                            <td>14</td>
                            <td class="q-id">DCONV2</td>
                            <td>Strategy challenged/questioned</td>
                            <td>Binary</td>
                            <td>0 = Open to learning, 1 = Defend thesis</td>
                        </tr>
                        <tr>
                            <td>15</td>
                            <td class="q-id">DCONV3</td>
                            <td>Establish strategic direction</td>
                            <td>Likert</td>
                            <td>1 = Market-reactive, 5 = Vision-driven</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 3 responses, scaled to 0-100</p>

                <h3>Dimension 5: Emotional Stability (3 questions)</h3>
                <p><em>Measures composure under pressure, stress management, and decision confidence despite uncertainty.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>16</td>
                            <td class="q-id">E1</td>
                            <td>Multiple simultaneous crises</td>
                            <td>Binary</td>
                            <td>0 = Deliberate pauses, 1 = Ruthless prioritization</td>
                        </tr>
                        <tr>
                            <td>17</td>
                            <td class="q-id">E2</td>
                            <td>Self-doubt in decisions</td>
                            <td>Binary</td>
                            <td>0 = Seeks validation, 1 = Moves confidently</td>
                        </tr>
                        <tr>
                            <td>18</td>
                            <td class="q-id">E3</td>
                            <td>Performance under pressure</td>
                            <td>Likert</td>
                            <td>1 = Visibly stressed, 5 = Calm & deliberate</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 3 responses, scaled to 0-100</p>

                <h3>Dimension 6: Skepticism & Adaptability (4 questions)</h3>
                <p><em>Measures independent thinking, resistance to groupthink, and willingness to pivot based on data.</em></p>
                <table class="dimension-table">
                    <thead>
                        <tr>
                            <th>Q#</th>
                            <th>ID</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Answer Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>19</td>
                            <td class="q-id">F1</td>
                            <td>Experienced advisor suggestions</td>
                            <td>Binary</td>
                            <td>0 = Weight track record, 1 = Test independently</td>
                        </tr>
                        <tr>
                            <td>20</td>
                            <td class="q-id">F2</td>
                            <td>View differs from group consensus</td>
                            <td>Binary</td>
                            <td>0 = Shift to align, 1 = Articulate & defend</td>
                        </tr>
                        <tr>
                            <td>21</td>
                            <td class="q-id">F3</td>
                            <td>Established industry approaches</td>
                            <td>Likert</td>
                            <td>1 = Follow as written, 5 = Reinvent</td>
                        </tr>
                        <tr>
                            <td>22</td>
                            <td class="q-id">F4</td>
                            <td>Data shows strategy needs to shift</td>
                            <td>Binary</td>
                            <td>0 = Analyze thoroughly, 1 = Adjust promptly</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Scoring:</strong> Average of all 4 responses, scaled to 0-100</p>
            </div>

            <div class="admin-section">
                <h2>üéØ Overall Score Calculation</h2>
                <p><strong>Final FounderFit Score</strong> = Average of all 6 dimension scores (0-100 scale)</p>
                <h3>Score Interpretation Bands:</h3>
                <div class="score-band">
                    <div class="score-band-range">80-100</div>
                    <div>Founder personality strongly aligned with success indicators. Your profile suggests high potential for building and scaling ventures.</div>
                </div>
                <div class="score-band">
                    <div class="score-band-range">65-79</div>
                    <div>Above-average alignment with founder success profile. You demonstrate strong entrepreneurial characteristics with room for development.</div>
                </div>
                <div class="score-band">
                    <div class="score-band-range">50-64</div>
                    <div>Average alignment with founder success profile. You have solid foundational traits with opportunities to strengthen key areas.</div>
                </div>
                <div class="score-band">
                    <div class="score-band-range">0-49</div>
                    <div>Below-average alignment with founder success profile. Consider how you might develop key entrepreneurial characteristics.</div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üî¢ Answer Key & Scoring Logic</h2>
                <h3>Binary Questions (0 or 1)</h3>
                <ul>
                    <li>Both answers are valid responses</li>
                    <li><strong>Scoring:</strong> Value / 5 √ó 100 to normalize to 0-100 scale
                        <ul>
                            <li>Answer = 0 ‚Üí contributes 0 points</li>
                            <li>Answer = 1 ‚Üí contributes 20 points</li>
                        </ul>
                    </li>
                </ul>

                <h3>Likert Questions (1-5)</h3>
                <ul>
                    <li><strong>Scoring:</strong> (Value - 1) / 4 √ó 100 to normalize to 0-100 scale
                        <ul>
                            <li>Answer = 1 ‚Üí 0 points</li>
                            <li>Answer = 2 ‚Üí 25 points</li>
                            <li>Answer = 3 ‚Üí 50 points</li>
                            <li>Answer = 4 ‚Üí 75 points</li>
                            <li>Answer = 5 ‚Üí 100 points</li>
                        </ul>
                    </li>
                </ul>

                <h3>Dimension Calculation</h3>
                <ul>
                    <li>Average all responses within a dimension</li>
                    <li>Convert to 0-100 scale using same normalization</li>
                    <li>Round to nearest integer</li>
                </ul>

                <h3>Overall Score Calculation</h3>
                <ul>
                    <li>Calculate all 6 dimension scores (0-100)</li>
                    <li>Average the 6 dimension scores</li>
                    <li>Round to nearest integer</li>
                    <li>Apply interpretation band</li>
                </ul>
            </div>

            <div class="admin-section">
                <h2>üí° Coaching Implications by Dimension</h2>
                
                <h3>Openness</h3>
                <div class="coaching-box">
                    <strong>High Openness (70+):</strong> Explorer, experimentalist‚Äîconsider adding structure and validation gates
                </div>
                <div class="coaching-box">
                    <strong>Low Openness (<40):</strong> Executor, validator‚Äîconsider more rapid prototyping and market testing
                </div>

                <h3>Conscientiousness</h3>
                <div class="coaching-box">
                    <strong>High Conscientiousness (70+):</strong> Detail-oriented‚Äîleverage for operational excellence and documentation
                </div>
                <div class="coaching-box">
                    <strong>Low Conscientiousness (<40):</strong> Visionary‚Äîpair with detail-oriented COO or operations lead
                </div>

                <h3>Energy & Drive</h3>
                <div class="coaching-box">
                    <strong>High Energy & Drive (70+):</strong> Unstoppable force‚Äîchannel toward long-term vision; manage burnout
                </div>
                <div class="coaching-box">
                    <strong>Low Energy & Drive (<40):</strong> Measured approach‚Äîfocus on sustainable scaling and team leverage
                </div>

                <h3>Conviction</h3>
                <div class="coaching-box">
                    <strong>High Conviction (70+):</strong> Visionary leader‚Äîvalidate thesis regularly to avoid sunk-cost bias
                </div>
                <div class="coaching-box">
                    <strong>Low Conviction (<40):</strong> Adaptable‚Äîensure strategic clarity and long-term direction commitment
                </div>

                <h3>Emotional Stability</h3>
                <div class="coaching-box">
                    <strong>High Emotional Stability (70+):</strong> Unflappable‚Äîyour calm is an asset; ensure team feels heard under pressure
                </div>
                <div class="coaching-box">
                    <strong>Low Emotional Stability (<40):</strong> Feeler‚Äîleverage this sensitivity for team dynamics; manage decision anxiety
                </div>

                <h3>Skepticism & Adaptability</h3>
                <div class="coaching-box">
                    <strong>High Skepticism & Adaptability (70+):</strong> Independent thinker‚Äîbalance with team alignment and consistency
                </div>
                <div class="coaching-box">
                    <strong>Low Skepticism & Adaptability (<40):</strong> Loyal executor‚Äîensure you're not accepting flawed advice; test assumptions
                </div>
            </div>

            <div class="admin-section">
                <h2>üìå Key Notes for Administrators</h2>
                <ul>
                    <li><strong>No wrong answers</strong> - The survey measures personality tendencies, not competence</li>
                    <li><strong>Dimension independence</strong> - Each dimension is independent; high scores in one don't require high scores in others</li>
                    <li><strong>Interpretation context</strong> - Score bands are relative; consider individual dimension profiles for nuanced coaching</li>
                    <li><strong>Response validation</strong> - All questions require an answer before proceeding</li>
                    <li><strong>Dimension profiles matter as much as overall score</strong> - a founder with low Openness but high Conviction may be validating an existing thesis effectively</li>
                </ul>
            </div>

            <div class="admin-section" id="reports-section">
                <h2>üìã Test Reports</h2>
                <p><em>View all completed assessments with detailed clinical analysis</em></p>
                <div id="reports-list" style="margin-top: 20px;">
                    <p style="text-align: center; color: #666;">Loading reports...</p>
                </div>
                <div id="report-detail" style="display: none; margin-top: 30px;"></div>
            </div>
        </div>
    </div>

    <div class="container" id="survey-container">
        <div class="header">
            <h1>FounderFit Score‚Ñ¢ v2.1</h1>
            <p>Founder Personality Assessment</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div class="progress-text"><span class="current-question">0</span> of <span class="total-questions">22</span></div>
        </div>

        <div class="content">
            <div id="questions-container"></div>
            
            <div class="context-collection-container" id="context-collection" style="display:none;">
                <h2>Almost Done!</h2>
                <p style="color: var(--color-text-light); margin-bottom: 30px;">Help us provide more accurate insights by answering these quick context questions.</p>
                
                <div class="context-form">
                    <div class="form-group">
                        <label><strong>Age Range *</strong></label>
                        <div class="radio-group">
                            <label><input type="radio" name="age" value="under-25"> Under 25</label>
                            <label><input type="radio" name="age" value="25-34"> 25-34</label>
                            <label><input type="radio" name="age" value="35-44"> 35-44</label>
                            <label><input type="radio" name="age" value="45-54"> 45-54</label>
                            <label><input type="radio" name="age" value="55-64"> 55-64</label>
                            <label><input type="radio" name="age" value="65+"> 65+</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><strong>Domain Experience *</strong></label>
                        <div class="radio-group">
                            <label><input type="radio" name="domain_exp" value="lt-1"> < 1 year</label>
                            <label><input type="radio" name="domain_exp" value="1-3"> 1-3 years</label>
                            <label><input type="radio" name="domain_exp" value="3-7"> 3-7 years</label>
                            <label><input type="radio" name="domain_exp" value="7+"> 7+ years</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Venture Stage (optional)</label>
                        <div class="radio-group">
                            <label><input type="radio" name="stage" value="pre-launch"> Pre-launch</label>
                            <label><input type="radio" name="stage" value="mvp"> MVP / early traction</label>
                            <label><input type="radio" name="stage" value="pmf-search"> PMF search</label>
                            <label><input type="radio" name="stage" value="scaling"> Scaling</label>
                            <label><input type="radio" name="stage" value="mature"> Mature</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Industry (optional)</label>
                        <div class="radio-group">
                            <label><input type="radio" name="industry" value="saas"> SaaS / software</label>
                            <label><input type="radio" name="industry" value="consumer-ecom"> Consumer / ecommerce</label>
                            <label><input type="radio" name="industry" value="services"> B2B services</label>
                            <label><input type="radio" name="industry" value="hardware-regulated"> Hardware / biotech / regulated</label>
                        </div>
                    </div>
                    
                    <button class="btn-submit-context" onclick="submitContext()">Continue to Results</button>
                </div>
            </div>

            <div class="email-collection-container" id="email-section" style="display:none;">
                <h2>Get Your Results</h2>
                <p style="color: var(--color-text-light); margin-bottom: 30px;">Enter your information to receive your detailed FounderFit Score‚Ñ¢ analysis via email.</p>
                
                <div class="email-form">
                    <div class="form-group">
                        <label for="user-name">Full Name</label>
                        <input type="text" id="user-name" placeholder="John Doe" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="user-email">Email Address</label>
                        <input type="email" id="user-email" placeholder="john@example.com" required>
                    </div>
                    
                    <button class="btn-submit-email" onclick="submitEmailAndShowResults()">View My Results</button>
                    <p class="privacy-note">We'll only use your email to send your results. No spam, ever.</p>
                </div>
            </div>

            <div class="results-container" id="results-section">
                <h2>Your FounderFit Score</h2>
                <div class="score-display" id="final-score">0</div>
                <div class="score-interpretation" id="score-text"></div>
                
                <h3 style="margin-top: 30px; color: var(--color-primary);">Dimension Breakdown</h3>
                <div class="dimension-scores" id="dimension-results"></div>
                
                <div id="validity-display"></div>
                <div id="success-display"></div>
                
                <button class="btn-reset" onclick="resetSurvey()">Start Over</button>
            </div>

            <div class="button-group" id="button-group">
                <button class="btn-prev" id="btn-prev" onclick="previousQuestion()" disabled>‚Üê Previous</button>
                <button class="btn-next" id="btn-next" onclick="nextQuestion()" disabled>Next ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://lcdcwtisiojbtsysjeic.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjZGN3dGlzaW9qYnRzeXNqZWljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODgwNTQsImV4cCI6MjA4MzU2NDA1NH0.j0BQsd9kdsiNrwFr-sqg-OelUiGcdXa5Y7cc6qspFMg';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        window.supabaseClient = supabaseClient;

/* FOUNDERFIT V5 INSTRUMENT
   30-question instrument (22 core + 8 validity)
   - option-order shuffling (kills "2nd option always better" + far-right bias)
   - reverse-scoring + nonlinear scoring
   - trait scoring + validity scoring + success index using context priors
*/


/* =========================
   0) UTILITIES
========================= */

// Stable-ish per-session seed so option order is consistent for a respondent.
const SESSION_SEED = (() => {
  const key = "ff_seed_v1";
  const existing = sessionStorage.getItem(key);
  if (existing) return parseInt(existing, 10);
  const seed = Math.floor(Math.random() * 1e9);
  sessionStorage.setItem(key, String(seed));
  return seed;
})();

function mulberry32(a) {
  return function() {
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

function shuffleInPlace(arr, rng) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function normalizeLikert01To100(v01) { // v01 in [0,1]
  return clamp(Math.round(v01 * 100), 0, 100);
}

function likertTo01(value1to5) {
  // 1..5 -> 0..1
  return (clamp(value1to5, 1, 5) - 1) / 4;
}

function reverseLikert(value1to5) {
  return 6 - clamp(value1to5, 1, 5);
}

/* =========================
   1) CONFIG: DIMENSIONS, WEIGHTS, PRIORS
========================= */

const DIMENSIONS = [
  "Openness",
  "Conscientiousness",
  "Energy & Drive",
  "Conviction",
  "Emotional Stability",
  "Skepticism & Adaptability",
];

const DIMENSION_WEIGHTS_BASE = {
  "Openness": 1.00,
  "Conscientiousness": 1.10,
  "Energy & Drive": 1.20,
  "Conviction": 1.10,
  "Emotional Stability": 1.30,
  "Skepticism & Adaptability": 1.00
};

// Stage multipliers (dimension emphasis)
const STAGE_WEIGHTS = {
  "pre-launch": {
    "Openness": 1.15, "Conscientiousness": 0.95, "Energy & Drive": 1.10,
    "Conviction": 1.10, "Emotional Stability": 1.00, "Skepticism & Adaptability": 1.00
  },
  "mvp": {
    "Openness": 1.10, "Conscientiousness": 1.00, "Energy & Drive": 1.10,
    "Conviction": 1.05, "Emotional Stability": 1.05, "Skepticism & Adaptability": 1.00
  },
  "pmf-search": {
    "Openness": 1.05, "Conscientiousness": 1.10, "Energy & Drive": 1.05,
    "Conviction": 1.05, "Emotional Stability": 1.10, "Skepticism & Adaptability": 1.05
  },
  "scaling": {
    "Openness": 0.95, "Conscientiousness": 1.20, "Energy & Drive": 1.05,
    "Conviction": 1.05, "Emotional Stability": 1.15, "Skepticism & Adaptability": 1.00
  },
  "mature": {
    "Openness": 0.95, "Conscientiousness": 1.15, "Energy & Drive": 1.00,
    "Conviction": 1.00, "Emotional Stability": 1.10, "Skepticism & Adaptability": 1.00
  },
};

// Industry multipliers (dimension emphasis)
const INDUSTRY_WEIGHTS = {
  "saas": {
    "Openness": 1.05, "Conscientiousness": 1.10, "Energy & Drive": 1.00,
    "Conviction": 1.00, "Emotional Stability": 1.00, "Skepticism & Adaptability": 1.00
  },
  "consumer-ecom": {
    "Openness": 1.05, "Conscientiousness": 1.00, "Energy & Drive": 1.15,
    "Conviction": 1.00, "Emotional Stability": 1.00, "Skepticism & Adaptability": 1.00
  },
  "services": {
    "Openness": 1.00, "Conscientiousness": 1.10, "Energy & Drive": 1.00,
    "Conviction": 1.00, "Emotional Stability": 1.10, "Skepticism & Adaptability": 1.00
  },
  "hardware-regulated": {
    "Openness": 0.95, "Conscientiousness": 1.20, "Energy & Drive": 1.00,
    "Conviction": 1.00, "Emotional Stability": 1.05, "Skepticism & Adaptability": 1.10
  },
};

// Conservative priors (v1 defaults; calibrate later with outcomes)
const AGE_PRIOR = {
  "under-25": 0.85,
  "25-34": 0.95,
  "35-44": 1.00,
  "45-54": 1.07,
  "55-64": 1.05,
  "65+": 1.02
};

const DOMAIN_EXP_PRIOR = {
  "lt-1": 0.85,
  "1-3": 0.95,
  "3-7": 1.05,
  "7+": 1.10
};

const FOUNDER_EXP_PRIOR = {
  "first-time": 1.00,
  "1": 1.03,
  "2-3": 1.06,
  "4+": 1.08
};

const CAPITAL_PRIOR = {
  "bootstrapped": 1.02,
  "angel-seed": 1.00,
  "vc": 0.98
};

/* =========================
   2) INSTRUMENT (22 CORE + 8 VALIDITY = 30)
   - Options are shuffled at render-time.
   - Each item carries scoring metadata.
========================= */

const QUESTION_BANK = [
  // ---------- CORE: OPENNESS (5)
  {
    id: "A1", dimension: "Openness", type: "binary",
    text: "You uncover a promising new market while executing against an existing roadmap. What do you do first?",
    options: [
      { key: "A", text: "Pressure-test whether it fits the current strategy before allocating time", traitDir: 0 },
      { key: "B", text: "Allocate time immediately to explore it hands-on", traitDir: 1 }
    ]
  },
  {
    id: "A2", dimension: "Openness", type: "binary",
    text: "Which statement describes you more accurately?",
    options: [
      { key: "A", text: "I prefer shipping small, controlled improvements once evidence is clear", traitDir: 0 },
      { key: "B", text: "I‚Äôm comfortable building rough experiments before evidence exists", traitDir: 1 }
    ]
  },
  {
    id: "A3", dimension: "Openness", type: "binary",
    text: "When encountering established industry norms, you are more likely to:",
    options: [
      { key: "A", text: "Assume they exist for good reasons unless proven otherwise", traitDir: 0 },
      { key: "B", text: "Assume they‚Äôre outdated until proven useful", traitDir: 1 }
    ]
  },
  {
    id: "A4", dimension: "Openness", type: "binary",
    text: "When learning a new tool or technology:",
    options: [
      { key: "A", text: "I want conceptual understanding before touching implementation", traitDir: 0 },
      { key: "B", text: "I learn fastest by using it immediately and refining later", traitDir: 1 }
    ]
  },
  {
    id: "A5", dimension: "Openness", type: "likert", reverse: true,
    text: "I am uncomfortable making decisions without most variables defined.",
    likertLabels: ["Strongly agree","Agree","Neutral","Disagree","Strongly disagree"]
  },

  // ---------- CORE: CONSCIENTIOUSNESS (3)
  {
    id: "BCONS1", dimension: "Conscientiousness", type: "binary",
    text: "In complex projects, I‚Äôm more effective when I:",
    options: [
      { key: "A", text: "Maintain oversight of dependencies and milestones myself", traitDir: 1 },
      { key: "B", text: "Define outcomes clearly and trust others to manage details", traitDir: 0 }
    ]
  },
  {
    id: "BCONS2", dimension: "Conscientiousness", type: "binary",
    text: "As the organization grows, which instinct shows up more often?",
    options: [
      { key: "A", text: "‚ÄúIf this is critical, I should stay close to it.‚Äù", traitDir: 1 },
      { key: "B", text: "‚ÄúIf this is critical, someone else should own it fully.‚Äù", traitDir: 0 }
    ]
  },
  {
    id: "BCONS3", dimension: "Conscientiousness", type: "likert",
    text: "Once I commit to a project, I tend to see it through even when alternatives appear.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"]
  },

  // ---------- CORE: ENERGY & DRIVE (4)
  {
    id: "C1", dimension: "Energy & Drive", type: "binary",
    text: "After a major setback, I usually:",
    options: [
      { key: "A", text: "Pause to re-assess before changing direction", traitDir: 0 },
      { key: "B", text: "Regain momentum quickly by trying the next approach", traitDir: 1 }
    ]
  },
  {
    id: "C2", dimension: "Energy & Drive", type: "binary",
    text: "When setting goals, I‚Äôm more motivated by:",
    options: [
      { key: "A", text: "Targets I‚Äôm confident we can hit", traitDir: 0 },
      { key: "B", text: "Targets that feel slightly unreasonable", traitDir: 1 }
    ]
  },
  {
    id: "C3", dimension: "Energy & Drive", type: "binary",
    text: "Teams respond best to me when I:",
    options: [
      { key: "A", text: "Engage deeply one-on-one", traitDir: 0 },
      { key: "B", text: "Create momentum through shared vision", traitDir: 1 }
    ]
  },
  {
    id: "C4", dimension: "Energy & Drive", type: "likert", hasRiskCap: true,
    text: "I struggle to disengage from long-term goals, even when it affects balance.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"]
  },

  // ---------- CORE: CONVICTION (3)
  {
    id: "DCONV1", dimension: "Conviction", type: "binary",
    text: "When stakeholders push back on my direction:",
    options: [
      { key: "A", text: "I assume they may see risks I‚Äôve missed", traitDir: 0 },
      { key: "B", text: "I assume my reasoning may be clearer than theirs", traitDir: 1 }
    ]
  },
  {
    id: "DCONV2", dimension: "Conviction", type: "binary",
    text: "When my strategy is questioned repeatedly:",
    options: [
      { key: "A", text: "I revisit assumptions and adjust if needed", traitDir: 0 },
      { key: "B", text: "I reinforce the rationale and stay the course", traitDir: 1 }
    ]
  },
  {
    id: "DCONV3", dimension: "Conviction", type: "likert", reverse: true,
    text: "My strategy is mostly shaped by external signals rather than internal conviction.",
    likertLabels: ["Strongly agree","Agree","Neutral","Disagree","Strongly disagree"]
  },

  // ---------- CORE: EMOTIONAL STABILITY (3)
  {
    id: "E1", dimension: "Emotional Stability", type: "binary",
    text: "When multiple urgent problems arise:",
    options: [
      { key: "A", text: "I slow down to avoid compounding mistakes", traitDir: 0 },
      { key: "B", text: "I narrow focus aggressively and act", traitDir: 1 }
    ]
  },
  {
    id: "E2", dimension: "Emotional Stability", type: "binary",
    text: "When uncertain about a decision:",
    options: [
      { key: "A", text: "I seek reassurance before committing", traitDir: 0 },
      { key: "B", text: "I commit and course-correct later if needed", traitDir: 1 }
    ]
  },
  {
    id: "E3", dimension: "Emotional Stability", type: "likert",
    text: "Under sustained pressure, others describe me as composed.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"]
  },

  // ---------- CORE: SKEPTICISM & ADAPTABILITY (4)
  {
    id: "F1", dimension: "Skepticism & Adaptability", type: "binary",
    text: "When experienced advisors suggest a different approach:",
    options: [
      { key: "A", text: "I weigh their track record heavily", traitDir: 0 },
      { key: "B", text: "I test the idea myself before committing", traitDir: 1 }
    ]
  },
  {
    id: "F2", dimension: "Skepticism & Adaptability", type: "binary",
    text: "When my view conflicts with group consensus:",
    options: [
      { key: "A", text: "I reconsider my position", traitDir: 0 },
      { key: "B", text: "I articulate my reasoning clearly", traitDir: 1 }
    ]
  },
  {
    id: "F3", dimension: "Skepticism & Adaptability", type: "likert", nonlinearMap: true,
    text: "Established best practices are usually:",
    // Values 1..5 stored, but we map to non-linear points later
    likertLabels: [
      "Rules to follow closely",
      "Useful guidelines",
      "Context-dependent",
      "Starting points",
      "Constraints to overcome"
    ]
  },
  {
    id: "F4", dimension: "Skepticism & Adaptability", type: "binary", contextDependent: true,
    text: "When data contradicts my strategy:",
    options: [
      { key: "A", text: "I analyze deeply before changing", traitDir: 0 }, // rigor-first
      { key: "B", text: "I adjust direction quickly", traitDir: 1 }      // speed-first
    ]
  },

  // ---------- VALIDITY (8)
  // V1 Attention: requires Agree (value=4 in standard 1..5)
  {
    id: "V1", dimension: "Validity", type: "likert", validityOnly: true,
    text: "To confirm you‚Äôre paying attention, please select ‚ÄúAgree‚Äù for this item.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    attention: { requiredValue: 4 }
  },
  // V2 Too-perfect (envy never)
  {
    id: "V2", dimension: "Validity", type: "likert", validityOnly: true,
    text: "I have never felt envy toward another founder‚Äôs wins.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    tooPerfect: { triggerValue: 5 }
  },
  // V3 Consistency with A5 (reverse)
  {
    id: "V3", dimension: "Validity", type: "likert", validityOnly: true,
    text: "I can make important decisions even when most variables are still unknown.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    consistency: { pairWith: "A5", direction: "inverse" } // A5 is discomfort, reverse-scored
  },
  // V4 Consistency with BCONS3
  {
    id: "V4", dimension: "Validity", type: "likert", validityOnly: true,
    text: "Once I commit to a plan, I rarely abandon it midstream.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    consistency: { pairWith: "BCONS3", direction: "same" }
  },
  // V5 Too-perfect (never avoidable mistake)
  {
    id: "V5", dimension: "Validity", type: "likert", validityOnly: true,
    text: "I have never made an avoidable mistake in a high-stakes situation.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    tooPerfect: { triggerValue: 4 } // Agree or Strongly agree are suspicious
  },
  // V6 Integrity (self report)
  {
    id: "V6", dimension: "Validity", type: "likert", validityOnly: true,
    text: "I answered these questions carefully and honestly.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    integrity: { minValue: 3 } // below neutral is a big issue
  },
  // V7 Second attention / infrequency: requires Disagree (value=2)
  {
    id: "V7", dimension: "Validity", type: "likert", validityOnly: true,
    text: "For quality control, please select ‚ÄúDisagree‚Äù for this item.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    attention: { requiredValue: 2 }
  },
  // V8 Infrequency (random clicking indicator)
  {
    id: "V8", dimension: "Validity", type: "likert", validityOnly: true,
    text: "I selected answers without reading the questions carefully.",
    likertLabels: ["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"],
    infrequency: { triggerValue: 4 } // Agree/Strongly agree = big penalty
  },
];

// Build an in-memory questions list with per-session option shuffling
function buildQuestionsForSession() {
  const rng = mulberry32(SESSION_SEED);

  return QUESTION_BANK.map((q) => {
    const copy = JSON.parse(JSON.stringify(q));

    // Shuffle binary option order (and preserve scoring via option.key / traitDir)
    if (copy.type === "binary" && Array.isArray(copy.options)) {
      shuffleInPlace(copy.options, rng);
    }

    // For likert: we do NOT shuffle the scale values (1..5), but we DO shuffle label positions sometimes by wording.
    // Here: keep labels stable for usability. (You already fixed directional bias via reverse + nonlinear maps.)

    return copy;
  });
}

/* =========================
   3) RENDER + RESPONSE STORAGE (HOOK INTO YOUR EXISTING UI)
   This expects you already have:
     - currentQuestion, responses, initSurvey(), showQuestion(), nextQuestion() etc.
   If you don't, you can still use the scoring functions below.
========================= */

// Expected response structure:
// responses[q.id] = { dimension, type, value, meta?: {...} }
// For binary: value is option.key ("A"/"B") OR store traitDir directly.
// For likert: value is integer 1..5.

// Helper: compute a 0‚Äì100 trait signal from a response
function itemScore01(q, resp, context) {
  // returns { score100, riskFlags:[], notes:[] } for CORE items only
  const riskFlags = [];
  const notes = [];

  if (!resp) return { score100: null, riskFlags, notes };

  // Skip validity-only items here
  if (q.validityOnly) return { score100: null, riskFlags, notes };

  if (q.type === "binary") {
    // Find chosen option by key (if resp.value is key) or by traitDir (if you stored that)
    let chosen = null;

    if (typeof resp.value === "string") {
      chosen = q.options.find(o => o.key === resp.value);
    } else if (typeof resp.value === "number") {
      // if you stored traitDir directly:
      chosen = q.options.find(o => o.traitDir === resp.value) || { traitDir: resp.value };
    }

    if (!chosen) return { score100: null, riskFlags, notes };

    // Context-dependent binary (F4): treat as trait signal now, fit later in success index.
    // traitDir 0/1 -> 0/100
    const score100 = chosen.traitDir ? 100 : 0;
    return { score100, riskFlags, notes };
  }

  if (q.type === "likert") {
    let v = clamp(parseInt(resp.value, 10), 1, 5);
    if (q.reverse) v = reverseLikert(v);

    // Nonlinear mapping (F3): break far-right-is-best pattern
    if (q.nonlinearMap) {
      // Map 1..5 to points: 20, 50, 80, 100, 70
      const map = { 1: 20, 2: 50, 3: 80, 4: 100, 5: 70 };
      return { score100: map[v] ?? 50, riskFlags, notes };
    }

    // C4 burnout risk flag if extreme
    if (q.hasRiskCap && q.id === "C4" && clamp(parseInt(resp.value, 10), 1, 5) === 5) {
      riskFlags.push("burnout_risk_high_drive_extreme");
    }

    const score100 = normalizeLikert01To100(likertTo01(v));
    return { score100, riskFlags, notes };
  }

  return { score100: null, riskFlags, notes };
}

/* =========================
   4) VALIDITY SCORING (0‚Äì100) + FLAGS
========================= */

function scoreValidity(responsesMap, msTotal = null) {
  let validity = 100;
  const flags = [];
  let tooPerfectPoints = 0;

  // Attention checks
  for (const q of questions) {
    if (!q.validityOnly) continue;
    const r = responsesMap[q.id];
    if (!r) continue;

    if (q.attention && q.attention.requiredValue) {
      if (parseInt(r.value, 10) !== q.attention.requiredValue) {
        flags.push(`attention_fail_${q.id}`);
        // hard-ish fail
        validity -= 40;
      }
    }
  }

  // Integrity + infrequency
  {
    const v6 = responsesMap["V6"];
    if (v6 && parseInt(v6.value, 10) < 3) {
      flags.push("integrity_low");
      validity -= 40;
    }
    const v8 = responsesMap["V8"];
    if (v8 && parseInt(v8.value, 10) >= 4) {
      flags.push("random_clicking_admitted");
      validity -= 35;
    }
  }

  // Too-perfect
  {
    const v2 = responsesMap["V2"];
    if (v2 && parseInt(v2.value, 10) === 5) tooPerfectPoints += 1;

    const v5 = responsesMap["V5"];
    if (v5 && parseInt(v5.value, 10) >= 4) tooPerfectPoints += 1;

    if (tooPerfectPoints >= 1) flags.push("too_perfect_signal");
    validity -= Math.min(30, tooPerfectPoints * 12);
  }

  // Consistency checks (convert paired items to 0..100 and compare)
  function likertAsScore100(qid) {
    const q = questions.find(x => x.id === qid);
    const r = responsesMap[qid];
    if (!q || !r) return null;

    let v = clamp(parseInt(r.value, 10), 1, 5);
    if (q.reverse) v = reverseLikert(v);
    if (q.nonlinearMap) {
      const map = { 1: 20, 2: 50, 3: 80, 4: 100, 5: 70 };
      return map[v] ?? 50;
    }
    return normalizeLikert01To100(likertTo01(v));
  }

  // V3 vs A5 (raw contradiction check)
  // V3: "I'm comfortable with uncertainty" (high = comfortable)
  // A5: "I feel discomfort when outcomes are unpredictable" (high = uncomfortable)
  // If BOTH are high (>=4), that's contradictory
  {
    const v3 = responsesMap["V3"];
    const a5 = responsesMap["A5"];
    if (v3 && a5) {
      const v3val = parseInt(v3.value, 10);
      const a5val = parseInt(a5.value, 10);
      if (v3val >= 4 && a5val >= 4) {
        flags.push("inconsistency_openness");
        validity -= 15;
      }
    }
  }

  // V4 vs BCONS3 (same)
  {
    const v4 = likertAsScore100("V4");
    const b3 = likertAsScore100("BCONS3");
    if (v4 != null && b3 != null) {
      const diff = Math.abs(v4 - b3);
      if (diff > 50) {
        flags.push("inconsistency_conscientiousness");
        validity -= 15;
      }
    }
  }

  // Optional: response-time anomaly (if you pass msTotal)
  if (typeof msTotal === "number") {
    // Very rough: under ~2.5 minutes for 30 items is suspicious for careful reading
    if (msTotal < 150000) {
      flags.push("speed_suspicious_fast");
      validity -= 10;
    }
  }

  validity = clamp(Math.round(validity), 0, 100);
  const confidenceBand = validity >= 80 ? "High" : validity >= 60 ? "Moderate" : "Low";
  return { validity, confidenceBand, flags };
}

/* =========================
   5) TRAIT SCORING (DIMENSIONS + OVERALL) + RISK FLAGS
========================= */

function scoreTraits(responsesMap) {
  const dimBuckets = {};
  const riskFlags = [];

  for (const d of DIMENSIONS) dimBuckets[d] = [];

  for (const q of questions) {
    if (q.validityOnly) continue;
    const r = responsesMap[q.id];
    const { score100, riskFlags: itemFlags } = itemScore01(q, r, null);
    if (score100 == null) continue;

    if (q.id === "C4" && itemFlags.includes("burnout_risk_high_drive_extreme")) {
      riskFlags.push("burnout_risk_high_drive_extreme");
    }

    // Push into dimension bucket
    if (DIMENSIONS.includes(q.dimension)) {
      dimBuckets[q.dimension].push(score100);
    }
  }

  const dimScores = {};
  for (const d of DIMENSIONS) {
    const vals = dimBuckets[d];
    const avg = vals.length ? (vals.reduce((a,b)=>a+b,0) / vals.length) : 0;
    dimScores[d] = Math.round(avg);
  }

  // Overall Trait Score (dimension-weighted base)
  const num = DIMENSIONS.reduce((s, d) => s + dimScores[d] * (DIMENSION_WEIGHTS_BASE[d] || 1), 0);
  const den = DIMENSIONS.reduce((s, d) => s + (DIMENSION_WEIGHTS_BASE[d] || 1), 0);
  const overall = den ? Math.round(num / den) : 0;

  // Optional: flag ‚Äútoo many extreme highs‚Äù (used as soft validity input elsewhere if you want)
  const extremeHighDims = Object.values(dimScores).filter(v => v >= 90).length;
  if (extremeHighDims >= 4) riskFlags.push("profile_extreme_many_dims");

  return { overallTraitScore: overall, dimScores, riskFlags };
}

/* =========================
   6) SUCCESS LIKELIHOOD INDEX (CONTEXT PRIORS + FIT WEIGHTS)
   Compute ONLY if validity >= 60 (recommended).
========================= */

function scoreSuccessIndex(traits, validityObj, context) {
  // context expected shape:
  // {
  //   ageBucket: "under-25"|"25-34"|"35-44"|"45-54"|"55-64"|"65+",
  //   domainExp: "lt-1"|"1-3"|"3-7"|"7+",
  //   stage: "pre-launch"|"mvp"|"pmf-search"|"scaling"|"mature" (optional),
  //   industry: "saas"|"consumer-ecom"|"services"|"hardware-regulated" (optional),
  //   founderExp: "first-time"|"1"|"2-3"|"4+" (optional),
  //   capital: "bootstrapped"|"angel-seed"|"vc" (optional)
  // }

  const { dimScores } = traits;
  const validity = validityObj?.validity ?? 100;
  if (validity < 60) {
    return { successIndex: null, note: "Validity below threshold; success index suppressed." };
  }

  const stageW = STAGE_WEIGHTS[context.stage || "mvp"] || STAGE_WEIGHTS["mvp"];
  const industryW = INDUSTRY_WEIGHTS[context.industry || "saas"] || INDUSTRY_WEIGHTS["saas"];

  // FitScore: dimension-weighted average (base weights * stage * industry)
  let num = 0, den = 0;
  for (const d of DIMENSIONS) {
    const w = (DIMENSION_WEIGHTS_BASE[d] || 1) * (stageW[d] || 1) * (industryW[d] || 1);
    num += (dimScores[d] || 0) * w;
    den += w;
  }
  let fitScore = den ? (num / den) : 0;

  // Special handling for context-dependent F4:
  // If scaling/hardware-regulated, favor rigor-first (traitDir 0); if pre-launch/consumer, favor speed-first (traitDir 1)
  const f4 = responses["F4"];
  if (f4 && typeof f4.value === "string") {
    const chose = (questions.find(q=>q.id==="F4")?.options || []).find(o=>o.key===f4.value);
    if (chose) {
      const isSpeed = chose.traitDir === 1;
      const stage = context.stage || "mvp";
      const industry = context.industry || "saas";
      const speedHelpful =
        (stage === "pre-launch" || stage === "mvp") && (industry === "consumer-ecom" || industry === "saas");
      const rigorHelpful =
        (stage === "scaling" || stage === "mature") || (industry === "hardware-regulated");

      if (isSpeed && rigorHelpful) fitScore -= 3; // small penalty
      if (!isSpeed && speedHelpful) fitScore -= 2; // small penalty
      if (isSpeed && speedHelpful) fitScore += 2;
      if (!isSpeed && rigorHelpful) fitScore += 2;
    }
  }

  // Priors
  const ageP = AGE_PRIOR[context.ageBucket] ?? 1.0;
  const domP = DOMAIN_EXP_PRIOR[context.domainExp] ?? 1.0;
  const fexpP = FOUNDER_EXP_PRIOR[context.founderExp || "first-time"] ?? 1.0;
  const capP  = CAPITAL_PRIOR[context.capital || "angel-seed"] ?? 1.0;

  let success = fitScore * ageP * domP * fexpP * capP * (validity / 100);

  // Burnout risk: small penalty unless Emotional Stability is high
  const burnoutFlag = traits.riskFlags.includes("burnout_risk_high_drive_extreme");
  if (burnoutFlag && (dimScores["Emotional Stability"] || 0) < 70) {
    success *= 0.97; // light penalty
  }

  success = clamp(Math.round(success), 0, 100);

  return { successIndex: success };
}

/* =========================
   7) CONTEXT MODULE (2 REQUIRED + 3 OPTIONAL)
   Call this AFTER the trait quiz before you compute SuccessIndex.
========================= */

const contextQuestions = [
  {
    id: "D1_AGE",
    text: "What is your age range?",
    options: [
      { key: "under-25", label: "Under 25" },
      { key: "25-34", label: "25‚Äì34" },
      { key: "35-44", label: "35‚Äì44" },
      { key: "45-54", label: "45‚Äì54" },
      { key: "55-64", label: "55‚Äì64" },
      { key: "65+", label: "65+" },
    ]
  },
  {
    id: "D6_DOMAIN_EXP",
    text: "How many years have you worked in this industry/domain?",
    options: [
      { key: "lt-1", label: "< 1 year" },
      { key: "1-3", label: "1‚Äì3 years" },
      { key: "3-7", label: "3‚Äì7 years" },
      { key: "7+", label: "7+ years" },
    ]
  },
  // OPTIONAL (recommended)
  {
    id: "D3_STAGE",
    text: "What stage is your current venture?",
    optional: true,
    options: [
      { key: "pre-launch", label: "Pre-launch (idea/prototype)" },
      { key: "mvp", label: "MVP / early traction" },
      { key: "pmf-search", label: "PMF search (repeatability unclear)" },
      { key: "scaling", label: "Scaling (repeatable acquisition + hiring)" },
      { key: "mature", label: "Mature / optimization" },
    ]
  },
  {
    id: "D5_INDUSTRY",
    text: "Which category best fits your business?",
    optional: true,
    options: [
      { key: "saas", label: "SaaS / software" },
      { key: "consumer-ecom", label: "Consumer / ecommerce" },
      { key: "services", label: "B2B services / agency" },
      { key: "hardware-regulated", label: "Hardware / biotech / regulated" },
    ]
  },
  {
    id: "D2_FOUNDER_EXP",
    text: "Founder experience (prior ventures)?",
    optional: true,
    options: [
      { key: "first-time", label: "First-time founder" },
      { key: "1", label: "1 prior venture" },
      { key: "2-3", label: "2‚Äì3 prior ventures" },
      { key: "4+", label: "4+ prior ventures" },
    ]
  },
  {
    id: "D4_CAPITAL",
    text: "Capital strategy (closest match)?",
    optional: true,
    options: [
      { key: "bootstrapped", label: "Bootstrapped" },
      { key: "angel-seed", label: "Angel / small seed" },
      { key: "vc", label: "VC-backed" },
    ]
  },
];

/* =========================
   8) ONE CALL TO RUN EVERYTHING (USE THIS IN YOUR EXISTING calculateScore())
========================= */

function runFounderFitScoring({ responsesMap, msTotal, context }) {
  // 1) Traits
  const traits = scoreTraits(responsesMap);

  // 2) Validity
  const validityObj = scoreValidity(responsesMap, msTotal);

  // 3) Success index (requires context)
  const successObj = scoreSuccessIndex(traits, validityObj, context);

  return { traits, validity: validityObj, success: successObj };
}

/* =========================
   9) NOTES FOR HOOKING INTO YOUR CURRENT APP
=========================

A) For binary questions in your UI:
   - set responses[q.id] = { dimension: q.dimension, type: "binary", value: chosenOption.key }

B) For likert questions in your UI:
   - set responses[q.id] = { dimension: q.dimension, type: "likert", value: chosenValue1to5 }

C) When finished:
   - collect context answers into:
     const context = {
       ageBucket: "...",
       domainExp: "...",
       stage: "...",         // optional
       industry: "...",      // optional
       founderExp: "...",    // optional
       capital: "..."        // optional
     }

D) Then call:
   const result = runFounderFitScoring({ responsesMap: responses, msTotal: elapsedMs, context });

E) Display:
   - result.traits.overallTraitScore
   - result.traits.dimScores
   - result.validity.validity + confidenceBand + flags
   - result.success.successIndex (may be null if validity < 60)

*/

        // ===== INTEGRATION LAYER =====
        // Session-specific shuffled questions
        const sessionQuestions = buildQuestionsForSession();
        const questions = sessionQuestions; // Alias for compatibility
        
        // UI State
        let currentQuestion = 0;
        const responses = {};
        let startTime = Date.now();
        let calculatedOverallScore = 0;
        let calculatedDimensionScores = {};
        let validityResult = null;
        let successResult = null;
        let contextData = null;

        // Initialize survey
        function initSurvey() {
            currentQuestion = 0;
            Object.keys(responses).forEach(key => delete responses[key]);
            startTime = Date.now();
            document.getElementById('survey-container').style.display = 'block';
            document.getElementById('email-section').style.display = 'none';
            document.getElementById('context-collection').style.display = 'none';
            document.getElementById('results-section').style.display = 'none';
            showQuestion();
        }

        // Show current question
        function showQuestion() {
            const q = questions[currentQuestion];
            const container = document.getElementById('questions-container');
            const progress = document.querySelector('.progress-fill');
            const currentQText = document.querySelector('.current-question');
            const totalQText = document.querySelector('.total-questions');
            
            progress.style.width = ((currentQuestion / questions.length) * 100) + '%';
            currentQText.textContent = currentQuestion + 1;
            totalQText.textContent = questions.length;
            
            let html = `<h3>${q.text}</h3><div class="options">`;
            
            if (q.type === 'binary') {
                q.options.forEach((opt, idx) => {
                    const checked = responses[q.id]?.value === opt.key ? 'checked' : '';
                    html += `
                        <label class="option ${checked}">
                            <input type="radio" name="q${currentQuestion}" value="${opt.key}" ${checked}
                                   onchange="selectOption('${q.id}', '${opt.key}', ${opt.traitDir}, '${q.dimension}', 'binary')">
                            <span>${opt.text}</span>
                        </label>`;
                });
            } else if (q.type === 'likert') {
                const labels = q.likertLabels || ['Strongly disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly agree'];
                for (let i = 1; i <= 5; i++) {
                    const checked = responses[q.id]?.value === i ? 'checked' : '';
                    html += `
                        <label class="option ${checked}">
                            <input type="radio" name="q${currentQuestion}" value="${i}" ${checked}
                                   onchange="selectOption('${q.id}', ${i}, null, '${q.dimension}', 'likert')">
                            <span>${labels[i-1]}</span>
                        </label>`;
                }
            }
            
            html += '</div>';
            container.innerHTML = html;
            
            updateButtons();
        }

        // Select option
        function selectOption(qId, value, traitDir, dimension, type) {
            responses[qId] = { dimension, type, value };
            document.getElementById('btn-next').disabled = false;
            
            // Update visual feedback
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.option').classList.add('selected');
        }

        // Navigation
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                // All questions answered - show context collection
                document.getElementById('questions-container').style.display = 'none';
                document.getElementById('button-group').style.display = 'none';
                document.getElementById('context-collection').style.display = 'block';
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        function updateButtons() {
            document.getElementById('btn-prev').disabled = currentQuestion === 0;
            const currentResponse = responses[questions[currentQuestion].id];
            document.getElementById('btn-next').disabled = !currentResponse;
        }

        function resetSurvey() {
            location.reload();
        }

        // Context collection
        function submitContext() {
            const ageBucket = document.querySelector('input[name="age"]:checked')?.value;
            const domainExp = document.querySelector('input[name="domain_exp"]:checked')?.value;
            const stage = document.querySelector('input[name="stage"]:checked')?.value || 'mvp';
            const industry = document.querySelector('input[name="industry"]:checked')?.value || 'saas';
            const founderExp = document.querySelector('input[name="founder_exp"]:checked')?.value || 'first-time';
            const capital = document.querySelector('input[name="capital"]:checked')?.value || 'angel-seed';
            
            if (!ageBucket || !domainExp) {
                alert('Please answer the required questions (age and domain experience)');
                return;
            }
            
            contextData = { ageBucket, domainExp, stage, industry, founderExp, capital };
            
            // Calculate scores
            calculateScores();
            
            // Show email collection
            document.getElementById('context-collection').style.display = 'none';
            document.getElementById('email-section').style.display = 'block';
        }

        // Calculate scores using new pipeline
        function calculateScores() {
            const elapsedMs = Date.now() - startTime;
            
            // Convert responses to format expected by scoring functions
            const responsesMap = {};
            Object.keys(responses).forEach(qId => {
                responsesMap[qId] = responses[qId];
            });
            
            // Run scoring pipeline
            const traits = scoreTraits(responsesMap);
            const validity = scoreValidity(responsesMap, elapsedMs);
            
            calculatedOverallScore = traits.overallTraitScore;
            calculatedDimensionScores = traits.dimScores;
            validityResult = validity;
            
            // Calculate success index if validity >= 60
            if (validity.validity >= 60) {
                const success = scoreSuccessIndex(traits, validity, contextData);
                successResult = success;
            } else {
                successResult = { successIndex: null, note: 'Success index suppressed due to low validity' };
            }
        }

        // Email collection and results display
        function submitEmailAndShowResults() {
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            
            if (!name || !email) {
                alert('Please enter your name and email');
                return;
            }
            
            displayResults(calculatedOverallScore, calculatedDimensionScores, name, email);
        }

        // Display results
        function displayResults(score, dimensionScores, name, email) {
            document.getElementById('email-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'block';
            
            // Overall score
            document.getElementById('final-score').textContent = score;
            document.getElementById('score-text').textContent = getScoreInterpretation(score);
            
            // Dimension scores
            const dimContainer = document.getElementById('dimension-results');
            let dimHTML = '';
            Object.entries(dimensionScores).forEach(([dim, val]) => {
                dimHTML += `
                    <div class="dimension-item">
                        <div class="dimension-header">
                            <span class="dimension-name">${dim}</span>
                            <span class="dimension-score">${val}</span>
                        </div>
                        <div class="dimension-bar">
                            <div class="dimension-fill" style="width: ${val}%"></div>
                        </div>
                    </div>`;
            });
            dimContainer.innerHTML = dimHTML;
            
            // Validity section
            const validityHTML = `
                <div class="validity-section">
                    <h3>Response Validity</h3>
                    <div class="validity-score">
                        <span>Validity Score: ${validityResult.validity}/100</span>
                        <span class="confidence-badge">${validityResult.confidenceBand} Confidence</span>
                    </div>
                    ${validityResult.flags.length > 0 ? `
                        <div class="validity-flags">
                            <strong>Flags:</strong> ${validityResult.flags.join(', ')}
                        </div>
                    ` : ''}
                </div>`;
            document.getElementById('validity-display').innerHTML = validityHTML;
            
            // Success index
            let successHTML = '';
            if (successResult.successIndex !== null) {
                successHTML = `
                    <div class="success-section">
                        <h3>Success Likelihood Index</h3>
                        <div class="success-score">${successResult.successIndex}/100</div>
                        <p>Based on your traits, validity, and context</p>
                    </div>`;
            } else {
                successHTML = `
                    <div class="success-section suppressed">
                        <h3>Success Likelihood Index</h3>
                        <p class="suppression-message">Success index suppressed due to low validity (${validityResult.validity}/100). 
                        Validity must be 60 or higher for reliable success prediction.</p>
                    </div>`;
            }
            document.getElementById('success-display').innerHTML = successHTML;
            
            // Save to Supabase
            saveReportToSupabase(score, dimensionScores, name, email);
        }

        function getScoreInterpretation(score) {
            if (score >= 80) return 'Exceptional founder profile with strong alignment across key dimensions.';
            if (score >= 60) return 'Strong founder profile with good potential for success.';
            if (score >= 40) return 'Moderate founder profile with areas for development.';
            return 'Developing founder profile with significant growth opportunities.';
        }

        // Save to Supabase
        async function saveReportToSupabase(score, dimensionScores, name, email) {
            try {
                const reportData = {
                    overall_trait_score: score,
                    dimension_scores: dimensionScores,
                    validity_score: validityResult.validity,
                    validity_flags: validityResult.flags,
                    confidence_band: validityResult.confidenceBand,
                    success_index: successResult.successIndex,
                    context: contextData,
                    responses: responses,
                    user_name: name,
                    user_email: email
                };
                
                const { data, error } = await window.supabaseClient
                    .from('test_reports')
                    .insert([reportData]);
                
                if (error) {
                    console.error('Supabase error:', error);
                } else {
                    console.log('Report saved successfully');
                    // Send email
                    await sendResultsEmail(name, email, score, dimensionScores);
                }
            } catch (err) {
                console.error('Error saving report:', err);
            }
        }

        // Send email
        async function sendResultsEmail(name, email, score, dimensionScores) {
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, score, dimensionScores, validityResult, successResult })
                });
                
                if (response.ok) {
                    console.log('Email sent successfully');
                } else {
                    console.error('Email send failed');
                }
            } catch (err) {
                console.error('Error sending email:', err);
            }
        }

    </script>
</body>
</html>