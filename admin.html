<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - FounderFit Score‚Ñ¢</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --color-primary: #1f8a70;
            --color-primary-light: #2aaa8a;
            --color-primary-dark: #166b54;
            --color-secondary: #f5f5f5;
            --color-text: #2c3e50;
            --color-text-light: #7f8c8d;
            --color-border: #e0e0e0;
            --color-success: #27ae60;
            --color-warning: #e67e22;
            --color-danger: #c0152f;
            --color-bg-light: #f8f9fa;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            padding: 40px;
        }

        .header {
            background: var(--color-primary);
            color: white;
            padding: 30px;
            margin: -40px -40px 40px -40px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: white;
            color: var(--color-primary);
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            padding: 40px;
            text-align: center;
        }

        .login-container h2 {
            color: var(--color-primary);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .login-btn {
            width: 100%;
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .login-btn:hover {
            background: var(--color-primary-dark);
        }

        .error-message {
            background: #fee;
            color: var(--color-danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .reports-section {
            margin-top: 40px;
        }

        .reports-section h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-card {
            background: var(--color-bg-light);
            border: 2px solid var(--color-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-card:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .report-info {
            flex: 1;
        }

        .report-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .report-meta {
            color: var(--color-text-light);
            font-size: 14px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .report-score {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .report-detail {
            display: none;
            background: white;
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .report-detail.active {
            display: block;
        }

        .back-btn {
            background: var(--color-text-light);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: var(--color-text);
        }

        .dimension-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dimension-card {
            background: var(--color-bg-light);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--color-primary);
        }

        .dimension-name {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 10px;
        }

        .dimension-score {
            font-size: 36px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--color-text-light);
        }

        .no-reports {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-light);
        }

        .interpretation {
            background: var(--color-bg-light);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--color-primary);
        }

        .coaching-section {
            margin-top: 30px;
        }

        .coaching-section h3 {
            color: var(--color-primary);
            margin-bottom: 15px;
        }

        .coaching-item {
            background: white;
            border: 1px solid var(--color-border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .coaching-item strong {
            color: var(--color-primary);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-container">
            <h2>üîê Admin Login</h2>
            <div id="error-message" class="error-message"></div>
            <form id="login-form">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter admin password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden">
        <div class="container">
            <div class="header">
                <h1>üìä FounderFit Score‚Ñ¢ Admin Panel</h1>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <!-- Reports List View -->
            <div id="reports-list">
                <div class="reports-section">
                    <h2>üìã Test Reports</h2>
                    <p style="color: var(--color-text-light); margin-bottom: 20px;">
                        View all completed assessments with detailed clinical analysis (most recent first)
                    </p>
                    <div id="reports-container">
                        <div class="loading">Loading reports...</div>
                    </div>
                </div>
            </div>

            <!-- Report Detail View -->
            <div id="report-detail" class="hidden"></div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://lcdcwtisiojbtsysjeic.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjZGN3dGlzaW9qYnRzeXNqZWljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODgwNTQsImV4cCI6MjA4MzU2NDA1NH0.j0BQsd9kdsiNrwFr-sqg-OelUiGcdXa5Y7cc6qspFMg';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        window.supabaseClient = supabaseClient;

        const ADMIN_PASSWORD = '1234';

        // Check if already logged in
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            showAdminPanel();
        }

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('error-message');

            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminPanel();
            } else {
                errorMsg.textContent = 'Incorrect password. Please try again.';
                errorMsg.classList.add('show');
            }
        });

        function showAdminPanel() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            loadReports();
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }

        async function loadReports() {
            const container = document.getElementById('reports-container');
            
            try {
                // Fetch reports ordered by created_at DESC (most recent first)
                const { data: reports, error } = await supabaseClient
                    .from('test_reports')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!reports || reports.length === 0) {
                    container.innerHTML = '<div class="no-reports">No reports yet. Complete a test to generate your first report.</div>';
                    return;
                }

                container.innerHTML = reports.map((report, index) => {
                    const date = new Date(report.created_at).toLocaleString();
                    const userInfo = report.user_name ? `${report.user_name} (${report.user_email})` : 'Anonymous';
                    
                    return `
                        <div class="report-card" onclick="viewReport('${report.id}')">
                            <div class="report-info">
                                <div class="report-title">Report #${reports.length - index}</div>
                                <div class="report-meta">
                                    <span>üìÖ ${date}</span>
                                    <span>üë§ ${userInfo}</span>
                                </div>
                            </div>
                            <div class="report-score">${report.overall_score}</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading reports:', error);
                container.innerHTML = '<div class="no-reports">Error loading reports. Please try again.</div>';
            }
        }

        async function viewReport(reportId) {
            try {
                const { data: report, error } = await supabaseClient
                    .from('test_reports')
                    .select('*')
                    .eq('id', reportId)
                    .single();

                if (error) throw error;

                const dimensionScores = report.dimension_scores;
                const date = new Date(report.created_at).toLocaleString();
                const userInfo = report.user_name ? 
                    `<p><strong>Name:</strong> ${report.user_name}</p><p><strong>Email:</strong> ${report.user_email}</p>` : 
                    '<p><em>Anonymous submission</em></p>';

                // Generate clinical analysis
                const interpretation = getScoreInterpretation(report.overall_score);
                const dimensionAnalysis = generateDimensionAnalysis(dimensionScores);
                const strengths = getStrengths(dimensionScores);
                const developmentAreas = getDevelopmentAreas(dimensionScores);
                const coaching = generateCoachingRecommendations(dimensionScores);

                const detailHTML = `
                    <button class="back-btn" onclick="backToReports()">‚Üê Back to Reports</button>
                    
                    <h2 style="color: var(--color-primary); margin-bottom: 20px;">Clinical Assessment Report</h2>
                    
                    <div style="background: var(--color-bg-light); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                        <p><strong>Report ID:</strong> ${report.id.substring(0, 8)}</p>
                        <p><strong>Date:</strong> ${date}</p>
                        ${userInfo}
                        <p><strong>Overall Score:</strong> <span style="font-size: 24px; color: var(--color-primary); font-weight: 700;">${report.overall_score}/100</span></p>
                    </div>

                    <div class="interpretation">
                        <h3 style="color: var(--color-primary); margin-top: 0;">Overall Assessment</h3>
                        <p>${interpretation}</p>
                    </div>

                    <h3 style="color: var(--color-primary); margin-top: 30px;">Dimension Scores</h3>
                    <div class="dimension-grid">
                        <div class="dimension-card">
                            <div class="dimension-name">Openness</div>
                            <div class="dimension-score">${dimensionScores.openness}</div>
                        </div>
                        <div class="dimension-card">
                            <div class="dimension-name">Conscientiousness</div>
                            <div class="dimension-score">${dimensionScores.conscientiousness}</div>
                        </div>
                        <div class="dimension-card">
                            <div class="dimension-name">Energy & Drive</div>
                            <div class="dimension-score">${dimensionScores.energy}</div>
                        </div>
                        <div class="dimension-card">
                            <div class="dimension-name">Conviction</div>
                            <div class="dimension-score">${dimensionScores.conviction}</div>
                        </div>
                        <div class="dimension-card">
                            <div class="dimension-name">Emotional Stability</div>
                            <div class="dimension-score">${dimensionScores.emotional_stability}</div>
                        </div>
                        <div class="dimension-card">
                            <div class="dimension-name">Skepticism & Adaptability</div>
                            <div class="dimension-score">${dimensionScores.skepticism}</div>
                        </div>
                    </div>

                    ${dimensionAnalysis}

                    ${strengths ? `
                        <div class="interpretation">
                            <h3 style="color: var(--color-success); margin-top: 0;">üí™ Key Strengths</h3>
                            ${strengths}
                        </div>
                    ` : ''}

                    ${developmentAreas ? `
                        <div class="interpretation">
                            <h3 style="color: var(--color-warning); margin-top: 0;">üìà Development Areas</h3>
                            ${developmentAreas}
                        </div>
                    ` : ''}

                    <div class="coaching-section">
                        <h3>üí° Coaching Recommendations</h3>
                        ${coaching}
                    </div>
                `;

                document.getElementById('reports-list').classList.add('hidden');
                document.getElementById('report-detail').innerHTML = detailHTML;
                document.getElementById('report-detail').classList.remove('hidden');

            } catch (error) {
                console.error('Error viewing report:', error);
                alert('Error loading report details. Please try again.');
            }
        }

        function backToReports() {
            document.getElementById('report-detail').classList.add('hidden');
            document.getElementById('reports-list').classList.remove('hidden');
        }

        function getScoreInterpretation(score) {
            if (score >= 80) {
                return "Founder personality strongly aligned with success indicators. Your profile suggests high potential for building and scaling ventures.";
            } else if (score >= 65) {
                return "Above-average alignment with founder success profile. You demonstrate strong entrepreneurial characteristics with room for development.";
            } else if (score >= 50) {
                return "Average alignment with founder success profile. You have solid foundational traits with opportunities to strengthen key areas.";
            } else {
                return "Below-average alignment with founder success profile. Consider how you might develop key entrepreneurial characteristics.";
            }
        }

        function generateDimensionAnalysis(scores) {
            const dimensions = [
                { name: 'Openness', score: scores.openness, high: 'Explorer and experimentalist‚Äîconsider adding structure and validation gates', low: 'Executor and validator‚Äîconsider more rapid prototyping and market testing' },
                { name: 'Conscientiousness', score: scores.conscientiousness, high: 'Detail-oriented‚Äîleverage for operational excellence and documentation', low: 'Visionary‚Äîpair with detail-oriented COO or operations lead' },
                { name: 'Energy & Drive', score: scores.energy, high: 'Unstoppable force‚Äîchannel toward long-term vision; manage burnout', low: 'Measured approach‚Äîfocus on sustainable scaling and team leverage' },
                { name: 'Conviction', score: scores.conviction, high: 'Visionary leader‚Äîvalidate thesis regularly to avoid sunk-cost bias', low: 'Adaptable‚Äîensure strategic clarity and long-term direction commitment' },
                { name: 'Emotional Stability', score: scores.emotional_stability, high: 'Unflappable‚Äîyour calm is an asset; ensure team feels heard under pressure', low: 'Feeler‚Äîleverage this sensitivity for team dynamics; manage decision anxiety' },
                { name: 'Skepticism & Adaptability', score: scores.skepticism, high: 'Independent thinker‚Äîbalance with team alignment and consistency', low: 'Loyal executor‚Äîensure you\'re not accepting flawed advice; test assumptions' }
            ];

            return `
                <div style="margin-top: 30px;">
                    <h3 style="color: var(--color-primary);">Detailed Dimension Analysis</h3>
                    ${dimensions.map(d => `
                        <div class="coaching-item">
                            <strong>${d.name} (${d.score}/100):</strong> ${d.score >= 70 ? d.high : d.score < 40 ? d.low : 'Balanced profile in this dimension'}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getStrengths(scores) {
            const strengths = [];
            if (scores.openness >= 70) strengths.push('Openness to new ideas and experimentation');
            if (scores.conscientiousness >= 70) strengths.push('Strong attention to detail and follow-through');
            if (scores.energy >= 70) strengths.push('High energy and drive to achieve goals');
            if (scores.conviction >= 70) strengths.push('Strong conviction in strategic direction');
            if (scores.emotional_stability >= 70) strengths.push('Exceptional composure under pressure');
            if (scores.skepticism >= 70) strengths.push('Independent thinking and adaptability');

            if (strengths.length === 0) return null;
            return '<ul>' + strengths.map(s => `<li>${s}</li>`).join('') + '</ul>';
        }

        function getDevelopmentAreas(scores) {
            const areas = [];
            if (scores.openness < 40) areas.push('Openness: Consider more rapid prototyping and experimentation');
            if (scores.conscientiousness < 40) areas.push('Conscientiousness: Build systems for operational excellence');
            if (scores.energy < 40) areas.push('Energy & Drive: Focus on sustainable motivation strategies');
            if (scores.conviction < 40) areas.push('Conviction: Develop clearer strategic direction');
            if (scores.emotional_stability < 40) areas.push('Emotional Stability: Work on stress management techniques');
            if (scores.skepticism < 40) areas.push('Skepticism: Practice questioning assumptions more actively');

            if (areas.length === 0) return null;
            return '<ul>' + areas.map(a => `<li>${a}</li>`).join('') + '</ul>';
        }

        function generateCoachingRecommendations(scores) {
            const recommendations = [];

            // Openness
            if (scores.openness >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Openness:</strong> Channel your exploratory nature with structured validation gates to balance innovation with execution.</div>');
            } else if (scores.openness < 40) {
                recommendations.push('<div class="coaching-item"><strong>Openness:</strong> Practice rapid prototyping and market testing to complement your validation-focused approach.</div>');
            }

            // Conscientiousness
            if (scores.conscientiousness >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Conscientiousness:</strong> Your attention to detail is valuable‚Äîuse it to build robust operational systems and documentation.</div>');
            } else if (scores.conscientiousness < 40) {
                recommendations.push('<div class="coaching-item"><strong>Conscientiousness:</strong> Consider partnering with a detail-oriented COO or operations lead to complement your visionary approach.</div>');
            }

            // Energy & Drive
            if (scores.energy >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Energy & Drive:</strong> Your drive is exceptional‚Äîensure you channel it toward long-term vision while managing burnout risk.</div>');
            } else if (scores.energy < 40) {
                recommendations.push('<div class="coaching-item"><strong>Energy & Drive:</strong> Focus on sustainable scaling strategies and leverage your team to multiply impact.</div>');
            }

            // Conviction
            if (scores.conviction >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Conviction:</strong> Your strong conviction is powerful‚Äîbalance it with regular thesis validation to avoid sunk-cost bias.</div>');
            } else if (scores.conviction < 40) {
                recommendations.push('<div class="coaching-item"><strong>Conviction:</strong> Work on developing clearer strategic direction while maintaining your adaptive flexibility.</div>');
            }

            // Emotional Stability
            if (scores.emotional_stability >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Emotional Stability:</strong> Your composure under pressure is an asset‚Äîensure your team feels heard during high-stress periods.</div>');
            } else if (scores.emotional_stability < 40) {
                recommendations.push('<div class="coaching-item"><strong>Emotional Stability:</strong> Develop stress management techniques and leverage your emotional sensitivity for team dynamics.</div>');
            }

            // Skepticism & Adaptability
            if (scores.skepticism >= 70) {
                recommendations.push('<div class="coaching-item"><strong>Skepticism & Adaptability:</strong> Your independent thinking is valuable‚Äîbalance it with team alignment and strategic consistency.</div>');
            } else if (scores.skepticism < 40) {
                recommendations.push('<div class="coaching-item"><strong>Skepticism & Adaptability:</strong> Practice questioning assumptions more actively to ensure you\'re not accepting flawed advice.</div>');
            }

            return recommendations.join('');
        }
    </script>
</body>
</html>
